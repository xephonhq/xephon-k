# BenchHub cleanup

In order to [use Xephon-K in BenchHub](https://github.com/xephonhq/xephon-k/issues/60), 
we have a lot of things to clean up,
also we will be using [go.ice](https://github.com/at15/go.ice) as bare bone for cli and server.


TODO

- [ ] group and close old issues

## Pre-BenchHub issues

Storage

- in memory
  - [In Memory Store](https://github.com/xephonhq/xephon-k/issues/3)
    - it also mentioned the abandoned **tsdb-ql** project https://github.com/xephonhq/tsdb-ql
    - flush from cache to disk periodically or under threshold is not implemented, in benchmarks, we either write to memory, or write to disk
    - https://github.com/allegro/bigcache use large memory in go
  - [concurrent map write ](https://github.com/xephonhq/xephon-k/issues/57)
  
- disk
  - [Local Disk store](https://github.com/xephonhq/xephon-k/issues/32)
  - [Data File Writer](https://github.com/xephonhq/xephon-k/issues/45)
  - [Data File Reader](https://github.com/xephonhq/xephon-k/issues/46)
  - [Data File Encoding Timestamp and Value](https://github.com/xephonhq/xephon-k/issues/47)
    - [ ] general purpose is hard to fit directly into current encoder ...
    - spent a lot of time dealing with endian ...
    
Meta store

- [Meta index and store](https://github.com/xephonhq/xephon-k/issues/25)
  - locality sensitive hashing, geo etc ... the issue was thinking too much
- [In Memory inverted index](https://github.com/xephonhq/xephon-k/issues/27)
  - talked a lot of efficient merging posting lists

API

- JSON API
  - [RESTful API](https://github.com/xephonhq/xephon-k/issues/4)
    - write is like KairosDB, a point is a `[ts, val]` array instead of `{t:ts, v:val}` object
    - read is like  Heroic + KairosDB, use JSON to describe the filter AST
  - [Read query semantics](https://github.com/xephonhq/xephon-k/issues/30)
- Protobuf
  - [GoDoc chose comment generated by protobuf as package documentation](https://github.com/xephonhq/xephon-k/issues/48)
- Internal
  - [Columnar format in memory representation for series](https://github.com/xephonhq/xephon-k/issues/49)
    - we are using row based representation internally, based on current proto definition
    - [ ] For streaming data in, the row format might be more proper, for internal, the columnar format using protobuf may not be efficient enough
    - influxdb guys are trying to use apache arrow format https://github.com/influxdata/arrow
    
Benchmark

- Tracker [Bench](https://github.com/xephonhq/xephon-k/issues/12)
  - [ ] **it contains some data set** in reference section
- [Record bench metrics and store in TSDB](https://github.com/xephonhq/xephon-k/issues/14)
- [Basic reporter](https://github.com/xephonhq/xephon-k/issues/18)
  - just aggregate simple numbers, I don't remember if we have histogram
  - [ ] now it's more likely we store all the metrics, further more, traces
- [http too many open file](https://github.com/xephonhq/xephon-k/issues/20)
  - [ ] need to adjust ulimit and monitor open file
- [Basic benchmark disk size increased from 8M -> 19M](https://github.com/xephonhq/xephon-k/issues/59)
  - [ ] this is why we need benchhub ... to remember what I did in previous benchmarks
  
Other Databases

- [Bench Prometheus](https://github.com/xephonhq/xephon-k/issues/17)
  - [ ] it is possible to use prometheus's new tsdb package directly though ...
- [Bench InfluxDB extremely poor performance](https://github.com/xephonhq/xephon-k/issues/15)
  - [ ] we didn't reproduce this in later tests during Xephon-S
- [Bench KairosDB](https://github.com/xephonhq/xephon-k/issues/16)
  - most time, got error on thrift client when load is high ...

Collector

- [System wide metrics collector](https://github.com/xephonhq/xephon-k/issues/21)
  - should now be a lib in benchhub or benchboard, the faster one
- [Process metrics collector](https://github.com/xephonhq/xephon-k/issues/22)
  - [ ] https://github.com/iovisor/bcc can provide a lot of kernel info for tracing
    - it also go binding https://github.com/iovisor/gobpf
- [Container Metrics Collector](https://github.com/xephonhq/xephon-k/issues/31)
- empty tracker [Collector](https://github.com/xephonhq/xephon-k/issues/39)

Stuff

- [Expose internal metrics](https://github.com/xephonhq/xephon-k/issues/28)

## Benchmark

- pkg/bench/scheduler.go
  - LimitBy choose the policy, number of points, or load time
  - use channel of `chan *common.IntSeries` to pass data to worker
  - reuse transport